import { groupBy } from "lodash";
import { createTRPCRouter, protectedProcedure } from "../trpc";

export const orderRouter = createTRPCRouter({
	my: protectedProcedure
		.query(async ({ ctx }) => {
			const orders = await ctx.db.orderArtwork
				.select(["order.*", "artwork.*", "order.user.*"])
				.getAll()
			const res = orders
				.filter(o => o.artwork && o.order && o.order.user)
				.map(o => ({
					...o.order!,
					user: o.order!.user!,
					oId: o.id,
					total: o.artwork!.price,
				}))
			const result = groupBy(res, "oId")
			console.log(result)
			return result
		}),
})
